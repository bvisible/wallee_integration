{% extends "templates/web.html" %}

{% block page_content %}
<div class="container py-5">
	<div class="row justify-content-center">
		<div class="col-md-6 text-center">

			{% if error %}
			<!-- Error State -->
			<div class="payment-error">
				<div class="error-icon mb-4">
					<svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
						<circle cx="40" cy="40" r="40" fill="#dc3545"/>
						<path d="M40 25V45M40 55V55.01" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
				</div>
				<h2 class="mb-3">{{ _("Payment Error") }}</h2>
				<p class="text-muted mb-4">{{ error }}</p>
				<div class="payment-details card mb-4">
					<div class="card-body">
						{% if transaction %}
						<p><strong>{{ _("Transaction ID") }}:</strong> {{ transaction.transaction_id }}</p>
						<p><strong>{{ _("Status") }}:</strong> {{ transaction.status }}</p>
						{% endif %}
						{% if payment_request %}
						<p><strong>{{ _("Reference") }}:</strong> {{ payment_request.name }}</p>
						{% endif %}
					</div>
				</div>
				<a href="/cart" class="btn btn-primary">{{ _("Return to Cart") }}</a>
				<a href="/contact" class="btn btn-outline-secondary ml-2">{{ _("Contact Support") }}</a>
			</div>

			{% elif status == "pending" %}
			<!-- Pending State -->
			<div class="payment-pending">
				<div class="pending-icon mb-4">
					<svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
						<circle cx="40" cy="40" r="40" fill="#ffc107"/>
						<path d="M40 25V45L50 50" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
				</div>
				<h2 class="mb-3">{{ _("Payment Processing") }}</h2>
				<p class="text-muted mb-4">{{ _("Your payment is being processed. Please wait...") }}</p>
				<div class="payment-details card mb-4">
					<div class="card-body">
						{% if transaction %}
						<p><strong>{{ _("Transaction ID") }}:</strong> {{ transaction.transaction_id }}</p>
						<p><strong>{{ _("Status") }}:</strong> {{ transaction.status }}</p>
						<p><strong>{{ _("Amount") }}:</strong> {{ frappe.format_value(transaction.amount, {"fieldtype": "Currency", "options": transaction.currency}) }}</p>
						{% endif %}
					</div>
				</div>
				<p class="text-muted small">{{ _("This page will automatically redirect once payment is confirmed.") }}</p>
				<div class="mt-4">
					<a href="" class="btn btn-primary" onclick="location.reload(); return false;">{{ _("Refresh Status") }}</a>
					<a href="/cart" class="btn btn-outline-secondary ml-2">{{ _("Return to Cart") }}</a>
				</div>
			</div>

			{% elif status == "failed" %}
			<!-- Failed State -->
			<div class="payment-failed">
				<div class="failed-icon mb-4">
					<svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
						<circle cx="40" cy="40" r="40" fill="#dc3545"/>
						<path d="M28 28L52 52M52 28L28 52" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
				</div>
				<h2 class="mb-3">{{ _("Payment Failed") }}</h2>
				<p class="text-muted mb-4">{{ _("We're sorry, but your payment could not be processed.") }}</p>
				{% if transaction and transaction.failure_reason %}
				<div class="alert alert-danger mb-4">
					<strong>{{ _("Reason") }}:</strong> {{ transaction.failure_reason }}
				</div>
				{% endif %}
				<a href="/cart" class="btn btn-primary">{{ _("Try Again") }}</a>
				<a href="/contact" class="btn btn-outline-secondary ml-2">{{ _("Contact Support") }}</a>
			</div>

			{% else %}
			<!-- Success State (fallback if redirect didn't work) -->
			<div class="payment-success">
				<div class="success-icon mb-4">
					<svg width="80" height="80" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
						<circle cx="40" cy="40" r="40" fill="#28a745"/>
						<path d="M25 42L35 52L55 32" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
				</div>
				<h2 class="mb-3">{{ _("Payment Successful!") }}</h2>
				<p class="text-muted mb-4">{{ _("Thank you for your payment. Your transaction has been completed successfully.") }}</p>
				<div class="payment-details card mb-4">
					<div class="card-body">
						{% if transaction %}
						<p><strong>{{ _("Transaction ID") }}:</strong> {{ transaction.transaction_id }}</p>
						<p><strong>{{ _("Amount") }}:</strong> {{ frappe.format_value(transaction.amount, {"fieldtype": "Currency", "options": transaction.currency}) }}</p>
						{% endif %}
					</div>
				</div>
				<a href="/shop" class="btn btn-primary">{{ _("Continue Shopping") }}</a>
				<a href="/orders" class="btn btn-outline-secondary ml-2">{{ _("View Orders") }}</a>
			</div>
			{% endif %}

		</div>
	</div>
</div>

{% if status == "pending" %}
<script>
// Auto-refresh after 5 seconds for pending payments
setTimeout(function() {
	location.reload();
}, 5000);
</script>
{% endif %}
{% endblock %}
